# [동대방네 Spring Data JPA] (2) 엔티티 연관관계 설정 

이번 글에서는 이 포스트 (1) 주제에 포함됐던 비즈니스 요구사항에 대응되는 엔티티 간 연관관계 설정 방법에 대한 내용을 포함한다. 단순히 비즈니스 요구사항에 맞춘 설계 방향에 대해서만 설명하지 않고, ORM을 통해 **객체**와 **관계형 데이터베이스** 간 패러다임의 불일치를 해결하는 관점에서도 설명을 할 예정이다.  



### | 비즈니스 요구사항 : 

비즈니스 요구사항에는 **중고거래 플랫폼** 에서 각 엔티티 간 연관관계를 형성하는 핵심 로직만 추렸다. 대부분 아래 요구사항을 처리하는 과정에서 대부분의 JPA 엔티티 간 연관관게를 매핑하는 것과 영속성 컨텍스트를 통한 영속성 전이 또는 지연 로딩 등 프로젝트에서 활용했던 다양한 옵션들을 활용할 수 있기 때문이다. 

아래 비즈니스 요구사항에 대해서 데이터는 자체 DB 서버를 구축한다. (<u>MySQL</u> 사용)

- **회원** : 

  - 회원가입 시, 회원은 관심 카테고리 (중고상품 카테고리) 중 3가지 이상을 선택해야 가입할 수 있다. 

  - 회원 탈퇴 시, 일정 기간 보관 후 (개인정보 처리방침 의거) 삭제 

    (단, 해당 유저가 주고 받은 채팅 데이터는 참고 관계만 끊는다) 

    

- **중고 거래** :

  - 유저는 업로드된 중고상품들을 대상으로 관심 물품으로 지정할 수 있다. (인스타그램 <u>좋아요 기능</u>)
  - 상품 기준으로, 해당 상품을 관심 품목으로 지정한 유저(들)은 조회할 수 <u>없다</u>.
  - 유저는 본인이 업로드한 중고상품 리스트를 조회할 수 있다.
  - 중고상품 상세 정보화면에서, 해당 중고상품 판매자의 프로필 정보를 조회할 수 있다.

- **채팅** :

  - 유저는 자신이 포함된 채팅방 목록을 조회할 수 있다. 
  - 유저는 참여하고 있는 채팅방 내 메시지를 조회할 수 있다.

___

### | Member & MemberCategory (회원과 회원의 관심 카테고리 관계) : 

### | Member & Product (회원과 중고상품 관계) : 

위 비즈니스 요구사항을 보면, 유저는 본인이 업로드한 중고상품 리스트를 조회할 수 있고, 반대로 중고상품 기준으로도 해당 중고상품의 판매자 정보를 조회할 수 있어야 한다. **객체 탐색** 방향으로 다시 표현하면 다음과 같다. 

- **Member → Product** 
- **Product → Member** 

위 방향 관계를 통해서 알 수 있듯이 우리 서비스의 비즈니스 요구사항에 따르면, **Member**와 **Product**는 양방향 관계로 설정해야 한다. 

### | Member & MemberLikeProduct (회원과 회원이 관심(좋아하는)있는 중고상품 관계) : 
# Dgumarket - Relationship of Entity on 회원 : 상품



<그림 1 : 회원 : 상품 엔티티 구조도> 

**동국대학교 중고거래 플랫폼** 프로젝트 내 엔티티 간 연관관계를 어떻게 설정했는 지에 대한 글이에요. 가장 핵심이 되는 엔티티 간의 관계를 정의하고 각 관계가 어떤 이유로 설정됐는 지를 설명해보려고 해요.

**중고거래 플랫폼**이라는 상황이라서 아마 대부분 JPA 연관관계 주제로 많은 책 또는 블로그에서 다루는 예제와가 많아 익숙하실 것 같아요 :-) 저희 팀 프로젝트에서 **회원 : 상품** 관계를 어떻게 정의했고, 즉시 로딩과 지연로딩 그리고 영속성 전이 (Transitive Persitence)와 관련한 주제를 소개하려고 해요.

피드백 및 질문은 언제나 환영이고. 적극적인 피드백 부탁드려요.

___

## 엔티티 관계, 방향성

### **회원 : 상품 = One :  Many ** <-> 상품 : 회원 = Many : One

우선 회원과 상품의 관계는 양방향 관계로 설정했어요. 객체 그래프 탐색 기능이 양 엔티티 기준으로 모두 필요한 상황이었기 때문인데요. 양방향 관계 설정에서는 두 엔티티 간 관계에 있어서 주인(Owner)를 지정해야 하는데, '다' 측면인 상품을 주인으로 설정했어요. 테이블 관계에서는 사실 한 쪽에만 외래 키가 존재해도 'join' 문을 통해서 양방향 관계를 설정할 수 있는데요, 엔티티 관계에서는 양방향 관계를 설정할 때 양 쪽 엔티티에 서로를 참조할 수 있는 필드가 필요해요. 그리고 주인-종속 관계를 따로 지정해야 하는 이유는 두 엔티티에 서로를 참조할 수 있는 필드 중 어떤 필드를 기준으로 조회할 것인 지를 JPA에 알려줘야 하기 때문이에요. 

주인-종속 관계를 설정할 때는 **mappedBy** 속성을 사용하는데, 종속 관계에 있는 엔티티 필드에 설정하면 돼요. 정리하면 **mappedBy**가 있는 엔티티가 양방향 관계를 맺고 있는 두 엔티티 간 관계에서 종속 관계에 있는 것이죠! 여기서 종속이라는 말에 집중하기 보다는 앞서 언급한 것처럼 두 엔티티를 조회할 때 어떤 필드를 기준으로 조회할 지 지정한다는 개념을 인지하는 것이 직관적인 이해를 도울 것 같아요! (저는 종속이라는 말 그대로의 의미로 다소 이해하는데 어려움이 있었어요!)

**1) 회원 ---> 상품** 

- 회원의 구매 상품 리스트 조회
- 회원의 판매 상품 리스트 조회

**2) 상품 ---> 회원** 

- 상품의 업로더인 지 확인 여부 (상품의 수정, 삭제 권한 체크 등과 같은 서비스 로직을 위함)

___

## 즉시 로딩? 지연 로딩? 

___

## 영속성 전이 : 회원이 탈퇴하면 탈퇴한 회원과 관련된 정보를 삭제하고 싶은데요? 



___







